<!DOCTYPE html>
<html lang="pt">

<head>
    <title>Controle de acesso</title>

    <link rel="stylesheet" href="vendor\twbs\bootstrap\dist\css\bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="vendor\datatables\datatables\media\css\jquery.dataTables.min.css">
    <link rel="stylesheet" href="app/view/template/style.css">
    <link rel="stylesheet" href="vendor\components\jqueryui\themes\base\jquery-ui.min.css">
    <script src="vendor\components\jquery\jquery.min.js"></script>
    <script src="vendor\components\jqueryui\jquery-ui.min.js"></script>
    <script src="vendor\twbs\bootstrap\dist\js\bootstrap.min.js"></script>
    <script type="text/javascript" charset="utf8" src="vendor\datatables\datatables\media\js\jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8" src="vendor\robinherbots\jquery.inputmask\dist\jquery.inputmask.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>


    <script>
        // Datatable setup
        var table;
        $(document).ready( function () {
            table = $('#tabela').DataTable( {

                "columnDefs": [
                    {"className": "dt-center", "targets": "_all"}
                ],

                  "language": {
                      "lengthMenu": "Mostrar _MENU_ itens por página",
                      "zeroRecords": "Nenhum registro encontrado",
                      "info": "Mostrando página _PAGE_ de _PAGES_",
                      "infoEmpty": "Não há registros",
                      "search": "Procurar:",
                      "paginate": {
                          "first":      "Primeiro",
                          "last":       "Último",
                          "next":       "Próximo",
                          "previous":   "Anterior"
                      }
                  }

              } );
        } );

        // Jquery datepicker and input masks setup
        $( function() {
            $("#datepicker").datepicker({
                minDate: 0, // não pode no passado
                maxDate: "+1w -1", // mostra 1 semana -1 dia
                dateFormat: "dd/mm/yy",
                showOtherMonths: true,
                selectOtherMonths: true
             });

            $("#datepicker").inputmask({ "mask": "99/99/9999" });
            $("#timepicker").inputmask({"mask": "99:99"});

            // check time validity
            $("#timepicker").change(function validateTimepicker(){
                var u_input = $("#timepicker").val().replace(/[^0-9\.]/g, '');
                var today = new Date().getHours();

                var output = document.querySelector("output");
                var timepicker = document.querySelector('#timepicker');

                if($("#datepicker").datepicker('getDate').getDate() <= new Date()){
                    if (u_input >= 700 && u_input <= 2300 && u_input > parseInt(new Date().getHours()+"00")) {
                       output.innerHTML = ('');
                    } else {
                        output.innerHTML = ('Horário inválido.');
                    }
                }
            } );

            // remove readonly attribute before submitting
            $("#submit-btn").click(function() {
                 $("#datepicker").removeAttr('readonly');
                 $("#autorizacaoForm").submit();
            });
        } );

        // Show all autorizações by a requisitante
        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i=0;i<vars.length;i++) {
                var pair = vars[i].split("=");
                if (pair[0] == variable) {
                  return decodeURIComponent(pair[1]);
                }
            }
            return ""; //not found
        }
        $(document).ready( function () {
            table.search( getQueryVariable("search") ).draw();
        } );

    </script>
</head>


    <!-- Side navigation -->
    <div class="sidenav">

        {% if session.loggedin == true %}
            <div class="bloquinho">
                <p>Pedro Silva</p>
                <p id="matricula">{{session.matricula}}</p>
            </div>

            <a href="?pagina=home">Página inicial</a>

            <hr style="background-color: #aaa">

            <a href="?pagina=registro">Registros</a>
            <a href="?pagina=autorizacao">Autorizações</a>
            <a href="?pagina=requisitante">Requisitantes</a>
            <a href="?pagina=usuario">Usuários</a>
            <a href="?pagina=categoria">Categorias de usuários</a>
            <a href="?pagina=turma">Turmas</a>
            <a href="?pagina=coordenacao">Coordenações</a>

            <hr style="background-color: #aaa">

            <a id="logout" href="?pagina=login&action=logout">Logout</a>
        {% else %}

            <a class="btn btn-primary" href="?pagina=login">Fazer login</a>

        {% endif %}
    </div>

    <!-- Page content -->
    <div style="margin-left: 15%"> <!-- Same as sidebar width -->
        <div class="main">
            {{"area_dinamica"}}
        </div>
    </div>

    <footer>

    </footer>
